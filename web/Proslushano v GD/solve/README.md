

![Logo](https://i.ibb.co/y6dVs4v/logo-2.png)


#  TulaCTF 2022. WEB-1. Proslushano v GD


## Первый этап

- Осматриваемся на [сайте](https://i.ibb.co/9bHRCjS/image.png) и видим возможность авторизации

- Входим на сайт

- Обновляя страницу, обращаем внимание, что мы не выходим из аккаунта. Очевидно, реализована сессия. Открываем [куки](https://i.ibb.co/6BjGg0S/image.png) и видим, что правда

- По структуре куки понимаем, что это JWT-токен. Отправляемся на [jwt.io](https://jwt.io) для анализа

- В структуре находим определение [роли](https://i.ibb.co/QPGdHZm/image.png)

- Меняем роль и подменяем куку на сайте, однако сессия сбрасывается, следовательно кука действительно проверяется

- Из теории JWT мы знаем, что данные подписываются, алгоритм нам известен - [HS256](https://i.ibb.co/QPGdHZm/image.png)

- Попробуем взломать втупую с помощью тулзы John the Ripper

```BASH
    john <файл с jwt> --show --format=HMAC-SHA256
```
[Результат](https://i.ibb.co/ZgktSSQ/image.png)

- Меняем роль и подписываем полученым секретом

- Подменяем куку и обновляем страницу

- Опа, кажется мы теперь [админ](https://i.ibb.co/550L0Sn/image.png) и мы можем продать гараж

## Второй этап

- Теперь нам доступна [форма](https://i.ibb.co/Zmxt4pj/image.png) создания поста

- Попробовав создать несколько постов, не трудно заметить, что изменяется имя изображения и его формат(превращается в png). Очевидно, изображение проходит какую-то обработку

- Частичка пентестера шепчет тебе: "как можно исполнить свой код через картинку?". Здравый смысл отвечает - запихнуть что-нибудь в свг

- Для начала пробуем просто загрузить svg. Ошибок не ловим, всё хорошо. Затем гуглим все возможные уязвимости, связанные с обработкой изображений

- В данном таске используется [CVE-2016-3717](https://www.opencve.io/cve/CVE-2016-3717), основанная на чтении локальных файлов на машине

- При успешной загрузке, вы можете читать любой локальный файл на сервере. Флаг находился в `/etc/passwd`. Пример payload лежит в этой же папке

- Результат использования [payload](https://i.ibb.co/pXJkP6K/image.png)


